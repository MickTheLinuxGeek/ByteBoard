{% extends 'base.html' %}

{% block title %}Forum Topics{% endblock %}

{% block content %}
<h2>Forum Topics</h2>

<p>
    <a href="{% url 'forum:new_topic' %}">Start a New Topic</a>
</p>

{# Check if the topics_page (Page object) has items #}
{% if topics_page.object_list %}
<ul>
    {# Loop through topics on the current page #}
    {% for topic in topics_page %} {# topics_page is a Page object, iterate directly over it #}
    <li>
        <a href="{% url 'forum:topic_detail' topic.id %}">
            {{ topic.subject }}
        </a>
        <small>
            by <a href="{% url 'forum:user_profile' topic.created_by.username %}">{{ topic.created_by.username }}</a>
            on {{ topic.created_at|date:"M d, Y H:i" }}
            ({{ topic.posts.count }} post{{ topic.posts.count|pluralize }})
        </small>
    </li>
    {% endfor %}
</ul>

{# Pagination Links #}
{% if topics_page.paginator.num_pages > 1 %} {# Only show pagination if there's more than one page #}
<div class="pagination">
            <span class="step-links">
                {# Previous Button #}
                {% if topics_page.has_previous %}
                    <a href="?page=1" title="First Page">&laquo; first</a>
                    <a href="?page={{ topics_page.previous_page_number }}" title="Previous Page">previous</a>
                {% else %}
                    <span class="disabled">&laquo; first</span>
                    <span class="disabled">previous</span>
                {% endif %}

                {# Elided Page Numbers #}
                {% for i in elided_page_range %}
                    {% if i == PAGINATOR_ELLIPSIS %}
                        <span class="ellipsis">{{ i }}</span>
                    {% elif i == topics_page.number %}
                        <span class="current">{{ i }}</span>
                    {% else %}
                        <a href="?page={{ i }}">{{ i }}</a>
                    {% endif %}
                {% endfor %}

                {# Next Button #}
                {% if topics_page.has_next %}
                    <a href="?page={{ topics_page.next_page_number }}" title="Next Page">next</a>
                    <a href="?page={{ topics_page.paginator.num_pages }}" title="Last Page">last &raquo;</a>
                {% else %}
                    <span class="disabled">next</span>
                    <span class="disabled">last &raquo;</span>
                {% endif %}
            </span>
</div>
<p style="text-align: center; margin-top: 5px;">
    <small>Page {{ topics_page.number }} of {{ topics_page.paginator.num_pages }}.</small>
</p>
{% endif %}

{% else %}
<p>No topics have been created yet.</p>
{% endif %}

{% endblock %}
