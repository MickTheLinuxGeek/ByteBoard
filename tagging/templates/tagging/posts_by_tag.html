{% extends 'base.html' %}

{% block title %}Posts tagged with "{{ tag.name }}"{% endblock %}

{% block content %}
<p><a href="{% url 'forum:forum_index' %}">&laquo; Back to Topics</a></p>

<h2>Posts tagged with "{{ tag.name }}"</h2>
<hr>

{% for post in posts %}
<div class="post" id="post-{{ post.id }}">
    <div class="post-avatar">
        <a href="{% url 'forum:user_profile' post.created_by.username %}">
            <img src="{{ post.created_by.profile.get_avatar_url }}" alt="{{ post.created_by.username }}'s avatar">
        </a>
    </div>
    <div class="post-content">
        <p>
            <strong><a href="{% url 'forum:user_profile' post.created_by.username %}">
                {{ post.created_by.username }}</a>
            </strong> 
            {% if post.created_by.profile.user_title %}
            <span class="user-title">{{ post.created_by.profile.user_title }}</span>
            {% endif %}
            <br>
            <small>Posted on {{ post.created_at|date:"M d, Y P" }}
            {% if post.updated_at %}
            (edited on {{ post.updated_at|date:"M d, Y P" }})
            {% endif %}</small>
        </p>
        <div class="post-message">
            {{ post.message|linebreaksbr }}
        </div>
        <div class="post-topic-link">
            <small>In topic: <a href="{% url 'forum:topic_detail' post.topic.id %}">{{ post.topic.subject }}</a></small>
        </div>
        {% if post.created_by.profile.signature %}
        <div class="post-signature">
            <hr style="margin: 10px 0; border-top: 1px dotted #ccc;">
            <small>{{ post.created_by.profile.get_sanitized_signature|safe }}</small>
        </div>
        {% endif %}
    </div>
</div>
{% if not forloop.last %}
<hr>{% endif %}
{% empty %}
<p>There are no posts with this tag yet.</p>
{% endfor %}

<!-- Pagination -->
{% if posts.has_other_pages %}
<div class="pagination">
    {% if posts.has_previous %}
        <a href="?page={{ posts.previous_page_number }}">&laquo; Previous</a>
    {% else %}
        <span class="disabled">&laquo; Previous</span>
    {% endif %}
    
    {% for i in posts.paginator.page_range %}
        {% if posts.number == i %}
            <span class="current">{{ i }}</span>
        {% else %}
            <a href="?page={{ i }}">{{ i }}</a>
        {% endif %}
    {% endfor %}
    
    {% if posts.has_next %}
        <a href="?page={{ posts.next_page_number }}">Next &raquo;</a>
    {% else %}
        <span class="disabled">Next &raquo;</span>
    {% endif %}
</div>
{% endif %}
{% endblock %}